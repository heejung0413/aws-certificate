
### 프롤로그
1. Amazon Virtual Private Cloud(VPC)는 사용자가 정의한 가상 네트워크에서 AWS 리소스를 실행할 수 있는 논리적으로 격리된 AWS 클라우드 섹션을 프로비저닝할 수 있다. 이는 인터넷에 직접 접속할 수 있는 퍼블릭 리소스가 있고, 접속할 수 없는 프라이빗일 수 있다. 퍼블릭 또는 프라이빗 리소스 그룹을 서브넷이라고 하며, 서브넷은 VPC에 IP 주소의 범위다.
> 서브넷이란?
>  - 서브네트워크는 대규모 네트워크 내의 작은 네트워크다.


### VPC(Amazon Virtual Private Cloud)
1. 수만은 EC2 인스턴스가 있는데 이 모든 리소스가 경계가 없으면 네트워크 트래픽 제한 없이 리소스 간에 흐를 수 있다. →  AWS <mark style="background: #FFF3A3A6;">리소스에 경계를 설정하는 데 사용할 수 있는 네트워킹 서비스</mark>
2. VPC를 사용하여 AWS 클라우드의 격리된 섹션을 프로비저닝할 수 있다. 
3. 이 격리된 섹션에서는 사용자가 정의한 가상 네트워크에서 리소스를 시작할 수 있다. 한 VPC 내에서 여러 서브넷으로 리소스를 구성할 수 있다. 
4. VPC에 VPC를 출입하는 트래픽만 허용하는 게이트웨이가 있다. 
	1. 하지만 이 게이트웨이는 경계에만 적용되며 그저 네트워크 보안의 구성요소일 뿐이다.

### 인터넷 게이트웨이
1. 인터넷의 퍼블릭 트래픽이 VPC에 액세스하도록 허용하려면 인터넷 게이트웨이를 VPC에 연결한다.
2. <mark style="background: #BBFABBA6;">인터넷 게이트웨이</mark>는 <mark style="background: #FFF3A3A6;">VPC와 인터넷 간의 연결</mark>이다. 
	1. 고객이 커피숍에 들어가기 위해 사용하는 출입문과 비슷한 것으로 생각할 수 있다. 
	2. 인터넷 게이트웨이가 없으면 아무도 VPC 내의 리소스에 접근할 수 없다.
![[Pasted image 20250309171818.png]]

### 만약 프라이빗 리소스만 포함된 VPC가 있다면?
- <mark style="background: #BBFABBA6;">가상 프라이빗 게이트웨이</mark>를 사용할 수 있다. 
	- 이는 집과 커피숍 사이의 도로가 있는데 보디가드와 함께 지나간다고 생각하면 된다. 
	- 보디가드는 <mark style="background: #FFF3A3A6;">추가 보호 계층</mark>이다. 
	- 보디가드는 주변의 다른 모든 요청으로부터 인터넷 트래픽을 암호화하는 <mark style="background: #FFF3A3A6;">가상 프라이빗 네트워크 연결(VPN</mark>)과 같다.
- 가상 프라이빗 게이트웨이는 <mark style="background: #FFF3A3A6;">보호된 인터넷 트래픽이 VPC로 들어오도록 허용하는 구성요소</mark>다. 
	- 이를 사용하면 VPC와 프라이빗 네트워크 간에 가상 프라이빗 네트워크(VPN) 연결을 설정할 수 있다.

### AWS Direct Connect
1. **데이터 센터와 VPC 간에** <mark style="background: #FFF3A3A6;">비공개 전용 연결을 설정하는 서비스</mark>다.
2. Direct Connect가 제공하는 프라이빗 연결은 네트워크 비용을 절감하고 네트워크를 통과할 수 있는 대역폭을 늘리는데 도움이 된다. 

> 📌 **대역폭**이란?
> - 네트워크나 통신에서 일정 시간 동안 전송할 수 있는 최대 데이터량

---



## 서브넷 과정

1. 고객이 계산원에게 음료를 주문한다. 계산원은 바리스타에게 주문을 전달한다. 하지만 일부 고객은 계산원을 건너뛰고 바리스타에게 직접 주문하려고 한다. 그러면 주문 흐름이 중단되고 고객이 커피숍의 제한 구역에 접근한 것이다.
2. 이 문제를 해결하려면 계산원과 바리스타를 별도의 워크스테이션에 배치하여 카운터 영역을 나눠야 한다. 계산원의 워크스테이션은 퍼블릭이고 바리스타의 워크스테이션은 프라이빗이다. 바리스타는 계산원으로 부터 주문을 받을 수 있지만 고객으로부터 직접 주문은 받을 수 없다.
3. 이는 AWS 네트워킹 서비스를 사용하여 리소스를 격리하고 네트워크 트래픽의 흐름을 정확히 결정하는 것과 비슷하다. 
4. 커피숍의 <mark style="background: #FFF3A3A6;">카운터 영역을 VPC</mark>로 생각할 수 있다. 카운터 영역은 계산원의 워크 스테이션과 바리스타 워크스테이션을 위한 두개의 영역으로 나뉜다. VPC에서 서브넷은 리소스를 그룹화하는데 사용되는 별개의 영역이다.
5. 패킷은 서브넷 경계를 지나는 모든 패킷은 네트워크 액세스 제어 목록, 즉 네트워크 ACL에서 검사된다.프로토콜 기준으로 패킷이 서브넷에 출입할 수 있는 권한이 잇는지 확인하기 위함이다.

### 서브넷
- 보안 또는 운영 요구 사항에 따라 리소스를 그룹화할 수 있는 VPC 내의 한 섹션
- 퍼블릭이거나 프라이빗일 수도
	- 📕 퍼블릭 서브넷
		- 누구나 액세스할 수 있는 리소스 포함
	- 📕 프라이빗 서브넷
		- 고객의 개인정보 및 주문 내역이 포함된 데이터베이스와 같이 프라이빗 네트워크를 통해서만 액세스할 수 있는 리소스가 포함
- VPC내에서 서브넷은 서로 통신 가능
	- 퍼블릭 서브넷에 있는 EC2 인스턴스가 프라이빗 서브넷에 있는 데이터베이스와 통신 가능
<img src="Pasted image 20250427161934.png" width="300">


### VPC의 네트워크 트래픽
1. 고객이 AWS 클라우드에서 호스팅되는 애플리케이션에 데이터를 요청하면 이 요청은 <mark style="background: #FFF3A3A6;">패킷으로 전송</mark>된다. 
	1. 📌 <mark style="background: #BBFABBA6;">패킷</mark>은 인터넷/네트워크를 통해 전송되는 <mark style="background: #FFF3A3A6;">데이터의 단위</mark>다.
2. 패킷은 <mark style="background: #FFF3A3A6;">인터넷 게이트웨이를 통해</mark> <mark style="background: #FFF3A3A6;">VPC로 들어간다.</mark> 
	1. 패킷이 서브넷으로 들어가거나 서브넷에서 나오려면 먼저 권한을 확인해야 한다. 
	2. 이 사용 권한은 패킷을 보낸 사람과 패킷이 서브넷의 리소스와 통신하려는 방법을 나타낸다.
3. 서브넷의 <mark style="background: #FFB8EBA6;">패킷 권한을 확인하는 VPC 구성요소</mark>는 <mark style="background: #BBFABBA6;">네트워크 액세스 제어 목록(ACL)</mark>이다.

> 📌 과정:  **인터넷 게이트웨이 →  VPC →  프라이빗/퍼블릭 서브넷**

---

### 네트워크 ACL (액세스 제어 목록)
1. ACL은 **서브넷 수준**에서 <mark style="background: #FFF3A3A6;">인바운드 및 아웃바운드 트래픽을 제어하는 가상 방화벽</mark>이다.
2. 마치 <mark style="background: #FFF3A3A6;">공항의 출입국 심사 직원</mark>인 것
3. AWS 계정에는 기본 네트워크 ACL이 포함된다. VPC를 구성할 때 계정의 기본 네트워크 ACL를 사용하거나 사용자 지정 네트워크 ACL를 생성할 수 있다.
4. ACL은 기본적으로 <mark style="background: #FFB8EBA6;">모든 인바운드 및 아웃바운드 트래픽을 허용</mark>하지만, 사용자가 자체 규칙을 추가하거나 수정할 수 있다. 
	1. **사용자 지정 네트워크 ACL**은 사용자가 허용할 트래픽을 지정하는 규칙을 추가할 때까지 모든 인바운드 및 아웃 바운드 트래픽을 거부한다. 
5. ACL에는 명시적 거부규칙도 있다. 이 규칙은 패킷이 목록의 다른 모든 규칙과 일치하지 않으면 해당 패킷이 거부되도록 한다.

### 스테이트리스 패킷 필터링
1. <mark style="background: #FFB8EBA6;">네트워크 ACL은 스테이트리스(stateless) 패킷 필터링을 수행</mark>한다. 즉, <mark style="background: #FFF3A3A6;">아무것도 기억하지 않고</mark> 각 방향으로 서브넷 경계를 통과하는 패킷만 확인한다.
2. 해당 요청에 대한 패킷 응답이 서브넷으로 변환될 때 네트워크 ACL은 이전 요청을 기억하지 못한다.
	1. 규칙 목록에 따라 패킷 응답을 확인하여 허용/거부 여부를 결정
3. 패킷에서 Amazon EC2 인스턴스에 대한 권한을 확인하는 VPC 구성요소는 <mark style="background: #BBFABBA6;">보안그룹</mark>이다.

![[Pasted image 20250309174023.png]]

### 보안 그룹
1. **EC2 인스턴스**에 대한 <mark style="background: #FFF3A3A6;">인바운드 및 아웃 바운드 트래픽을 제어하는 가상 방화벽</mark>이다.
2. 기본적으로 보안그룹은 <mark style="background: #FFB8EBA6;">모든 인바운드 트래픽을 거부하고 모든 아웃바운드 트래픽을 허용한다</mark>. 사용자 지정 규칙을 추가하여 허용해야 할 트래픽을 구성할 수 있다. 그러면 나머지 트래픽은 거부된다.
	1. 🔴 **모든 인바운드 트래픽 거부**
	2. 🔴 **모든 아웃바운드 트래픽 허용**
3. <mark style="background: #FFF3A3A6;">마치 경비원</mark>이다. 로비에서 방문객을 안내하는 경비원은 방문객이 건물 안에 들어갈지 확인하지만 건물을 나갈 때는 경비원이 목록에서 다시 확인하지 않는다.
4. 동일한 VPC 내에 여러 Amazon EC2 인스턴스가 있는 경우 동일한 보안 그룹에 연결하거나 각 인스턴스 마다 다른 보안그룹을 사용할 수 있다.

### 스테이트풀(stateful) 패킷 필터링
1. 보안그룹은 <mark style="background: #BBFABBA6;">스테이트풀 패킷 필터링</mark>을 수행한다. 즉, 들어오는 패킷에 대한 <mark style="background: #FFB8EBA6;">이전 결정을 기억</mark>한다. 
2. 해당 요청에 대한 패킷 응답이 인스턴스로 반환될 때 보안 그룹이 이전 요청을 기억한다. 
3. 보안그룹은 인바운드 보안 그룹 규칙에 관계없이 응답이 진행하도록 허용한다.
![[Pasted image 20250309174523.png]]

4. 네트워크 ACL과 보안그룹을 모두 사용하면 VPC에서 트래픽에 대한 사용자 지정 규칙을 구성할 수 있다. 


### 🔴  정리

![[Pasted image 20250427163321.png]]
1. **인터넷 게이트웨이**
2. **VPC**로 들어온다.
3. **네트워크 액세스 제어 목록(ACL)**
	1. 서브넷 단위
	2. <mark style="background: #FFF3A3A6;">스테이트리스 패킷 필터링 </mark>
		1. 인바운드, 아웃바운드 모두 확인
		2. 허용 및 거부 규칙 모두 가능
		3. 모든 인바운드 및 아웃바운드 트래픽 허용
		4. 상태 비저장
4. 권환 확인하기 위해 **보안그룹**으로 이동
	1. 인스턴스 단위
	2. <mark style="background: #FFF3A3A6;">스테이트풀 패킷 필터링</mark>
		1. 모든 인바운드 거부
		2. 모든 아웃바운드 허용
		3. 허용 규칙만 가능
		4. 상태 저장

---
## 글로벌 네트워킹
### 도메인 이름 시스템(DNS)
1. DNS 확인은 도메인 이름을 IP 주소로 변환하는 프로세스


### Amazon Route 53
1. DNS 웹 서비스
2. 사용자 요청을 AWS에서 실행되는 인프라(예: EC2 인스턴스 및 로드 밸런서)에 연결한다. 
	1. 사용자를 AWS 외부의 인프라로 라우팅할 수 있다.
3. 도메인 이름의 DNS 레코드를 관리하는 기능도 있다.
4. 직접 새 도메인 이름을 등록할 수 있다.
5. 다른 도메인 등록 대행자가 관리하는 기존 도메인 이름의 DNS 레코드를 전송할 수 있다. 그러면 단일 위치에서 모든 도메인 이름을 관리할 수 있다.

### Amazon Route 53 및 Amazon CloudFront가 콘텐프를 전송하는 방식
![[Pasted image 20250310005442.png]]

1. 어떤 회사의 애플리케이션이 여러 EC2 인스턴스에서 실행 중이라고 가정하자. 
	1. 고객이 회사의 웹 사이트로 이동하여 애플리케이션에서 데이터를 요청한다.
	2. **amazon route 53**은 DNS 확인을 사용하여 <mark style="background: #FFF3A3A6;">DNS 주소를 IP 주소로 식별</mark>한다.
	3. 고객의 요청은 **Amazon CloudFront**를 통해 가장 가까운 엣지 로케이션으로 전송된다.
		1. Amazon CloudFront는 수신 패킷을 Amazon EC2 인스턴스로 전송하는 **Application Load Balancer에 연결**된다.